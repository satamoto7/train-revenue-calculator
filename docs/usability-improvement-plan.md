# ユーザビリティ改善計画: 18xx 収益計算補助アプリ

## Context

現在のアプリは機能的には充実しているが、以下の根本的なユーザビリティ問題を抱えている:

1. **モバイル/タブレットで使えない** — ボードゲーム卓ではスマホ・タブレットが主な利用端末だが、hover依存のUIでタッチ操作に対応していない
2. **初回ユーザーが迷う** — 空のサマリー画面がデフォルト表示で、何をすべきか分からない
3. **ゲーム中の操作が非効率** — 企業間の切り替え・収益入力・確認に過剰なスクロールとタブ切り替えが必要
4. **編集パターンが不統一** — プレイヤー名はモーダル、企業名はインライン、停車地点はクリック編集と3種類が混在
5. **情報過多の企業詳細画面** — 5セクションが縦に並び、常にスクロールが必要

これらを5フェーズに分けて改善する。データモデル・localStorage互換性は完全に維持する。

---

## Phase 1: モバイルタッチ対応 (最優先)

ボードゲーム卓ではタブレット/スマホが主要端末。現状のhover依存UIはタッチデバイスで操作不能。

### 1.1 停車地点エディタのボタンを常時表示化

**対象:** `RevenueStopEditor` コンポーネント (`src/App.js`)

3箇所の `opacity-0 group-hover:opacity-100 group-focus-within:opacity-100` を以下に変更:

```
opacity-100 sm:opacity-0 sm:group-hover:opacity-100 sm:group-focus-within:opacity-100
```

- 挿入ボタン
- +10/-10 ボタンラッパー
- 削除ボタン

モバイル(sm未満)では常時表示、デスクトップではhover時に表示する。

### 1.2 タッチターゲットサイズの拡大

| 要素 | 現在 | 変更後 |
|------|------|--------|
| 挿入ボタン | `p-0.5` | `p-2 sm:p-1` |
| 削除ボタン | `p-0.5` | `p-2 sm:p-1` |
| +10/-10 ボタン | `px-1` | `px-2 py-1` |

### 1.3 収益クイック追加ボタンのレスポンシブ化

**対象:** `RevenueInput` コンポーネント

- グリッド: `grid-cols-5` -> `grid-cols-3 sm:grid-cols-5`
- ボタンpadding: `py-1 px-2` -> `py-2 px-3 sm:py-1 sm:px-2`
- gap: `gap-1` -> `gap-1.5 sm:gap-1`

### 1.4 数値入力欄の幅拡大

- `w-16` -> `w-20 sm:w-16` (停車地点編集input、株式割合input)

---

## Phase 2: 初回ユーザー体験の改善

### 2.1 新規ユーザーのデフォルト画面を管理画面に

localStorageからデータ読み込み後、`players.length === 0 && companies.length === 0` の場合に `currentView` を `'management'` に設定。既存ユーザー(データあり)はこれまで通りサマリー表示。

### 2.2 サマリー画面に空状態ガイドを追加

データが空の場合にウェルカムカードを表示:

```
「はじめに」
「ゲームを開始するには、まず「全般管理」タブでプレイヤーと企業を登録してください。」
[セットアップを始める] ボタン -> management画面へ遷移
```

### 2.3 空の列車で入力欄をデフォルト表示

`showRevenueInput` の初期値を `train.stops.length === 0` に変更。停車地点がない新しい列車では自動的に入力欄が開く。

---

## Phase 3: ゲームワークフローの最適化

18xxのOR中の典型フロー「企業選択 -> 列車走行 -> 収益記録 -> 次の企業」に合わせてUIを最適化。

### 3.1 企業セレクタに進捗インジケータを追加

未選択の企業pillに収益入力状況を色で反映:
- OR収益あり -> 緑系の背景色
- OR収益なし -> グレー（現状通り）

### 3.2 前/次の企業ナビゲーションボタンを追加

```
[<- 前の企業]  (1 / 8)  [次の企業 ->]
```

企業間の移動をワンクリックで可能にし、ゲーム中のOR処理フローを効率化。

### 3.3 OR収益入力をコンパクト化して企業ヘッダー直下に配置

現在のlime背景フルセクションを、企業名の直下にコンパクトなインライン行として再配置:

```
[OR1: [___]] [OR2: [___]]  (横並びのコンパクト表示)
```

スクロール量を削減し、最も頻繁に使う操作を画面上部に配置。

### 3.4 企業切り替え時に画面上部へスクロール

`handleSelectCompany` に `window.scrollTo({ top: 0, behavior: 'smooth' })` を追加。

---

## Phase 4: 編集パターンの統一

### 4.1 プレイヤー名編集をインライン方式に変更

現在のモーダル方式を、企業名と同じインライン編集方式に統一:

- pill内に直接インライン入力欄を表示
- Enter/Escapeでの確定・キャンセル
- プレイヤー名編集用モーダルを完全に削除

操作パターンを統一することで、ユーザーの学習コストを下げる。

---

## Phase 5: 情報密度とアクセシビリティの改善

### 5.1 企業詳細画面のセクション折りたたみ

各セクションヘッダーをクリックで折りたたみ可能に:

| セクション | デフォルト状態 |
|-----------|-------------|
| 列車運行 | 展開 |
| 株式保有 | 折りたたみ |
| 配当金 | 折りたたみ |

スクロール量を大幅に削減し、現在作業中のセクションに集中できるようにする。

### 5.2 小さすぎるテキストの改善

情報コンテンツ（ラベル、値）に使われている `text-xs` を `text-sm` に変更:
- SummaryView のOR詳細テキスト
- RevenueInput のラベル・ボタン
- PercentageInputControl のボタン

### 5.3 Unicode記号をより明確なラベルに変更

- 挿入ボタン: より視認性の高いスタイルに変更
- 削除ボタン: 背景色を追加して目立たせる

---

## テスト戦略

### 既存テストへの影響

- Phase 2 で初回表示がmanagementに変わるため、初期表示テストの更新が必要
- その他の既存テストは影響なし

### 各フェーズの検証方法

| Phase | 検証方法 |
|-------|---------|
| 1 | Chrome DevToolsのモバイルエミュレーションでボタン表示・タップを確認 |
| 2 | localStorage削除後にリロード -> management画面表示を確認 |
| 3 | 企業切り替え -> スクロール位置リセット確認。前/次ボタン動作確認 |
| 4 | プレイヤー名クリック -> インライン編集確認。モーダルが出ないことを確認 |
| 5 | セクション折りたたみ/展開確認。テキストサイズの視認性確認 |

全フェーズ共通: `npm test` でテストパス確認、`npm start` でビルド・動作確認。

---

## 変更対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `src/App.js` | 全フェーズの変更対象 (UIコンポーネント修正) |
| `src/App.test.js` | Phase 2に伴うテスト更新 + 各フェーズの新規テスト追加 |

**データモデル変更: なし** — localStorage互換性は完全に維持。
